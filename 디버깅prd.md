# 📝 Debugging PRD: 카드 뉴스 자동 생성 시스템 오류 분석 및 해결

## 1. 시스템 아키텍처 (System Architecture)
현재 시스템은 5분 주기로 작동하며 다음과 같은 파이프라인을 가집니다.
1. **Collector**: 5분 주기 뉴스 크롤링 (제목, 이미지, 본문 추출)
2. **Pre-processor**: 동일 뉴스 제거 및 데이터 변환
3. **LLM Engine**: Gemini API 호출 → 본문 기반 3줄 요약 생성
4. **Storage**: 요약 데이터 포함 2차 데이터 저장
5. **Delivery**: 사용자 요청 시 최종 데이터 서빙 (API)

---

## 2. 발생 현상 및 결함 목록 (Issue List)

| ID | 문제 정의 (Problem) | 현상 상세 |
| :--- | :--- | :--- |
| **ERR-01** | **데이터 로드 실패** | 카드 뉴스 본문 및 이미지가 빈 값으로 출력됨 |
| **ERR-02** | **컨텍스트 불일치** | 뉴스 제목과 관련 없는 엉뚱한 본문이 매칭됨 |
| **ERR-03** | **노이즈 데이터 유입** | 뉴스 본문에 커뮤니티 댓글이나 광고 문구가 포함됨 |
| **ERR-04** | **UI 인터랙션 오류** | 카드 뉴스 클릭 시 상세 내용이 펼쳐지지 않음 |
| **ERR-05** | **요약 기능 마비** | 세 줄 요약이 생성되지 않거나 API 한도 초과 에러 발생 |

---

## 3. 가설 및 심층 분석 (Hypothesis & Analysis)

### 3.1. Gemini API 한도 초과 및 요약 실패 (ERR-05)
* **현상:** 무료 요금제 범위 내임에도 Quota Exceeded 발생 및 요약본 누락.
* **추정 원인:**
    * **RPM(Requests Per Minute) 제한:** 5분마다 '배치(Batch)'로 대량 호출 시, 일일 한도는 넉넉해도 순간적인 분당 호출 제한에 걸릴 수 있음.
    * **Context Window 초과:** 크롤링된 본문(댓글 포함 등)이 지나치게 길어 API 입력 토큰 제한을 초과했을 가능성.
    * **비정상 응답 처리 미비:** API 에러 발생 시 빈 값으로 DB에 저장되는 로직 문제.

### 3.2. 본문 오염 및 불일치 (ERR-02, ERR-03)
* **추정 원인:**
    * **DOM 선택자 오염:** 뉴스 사이트마다 다른 HTML 구조로 인해 본문 태그(`article`, `div`)가 아닌 댓글 영역이 크롤링됨.
    * **중복 제거 로직 결함:** 동일 뉴스 제거 과정에서 인덱스가 꼬여 제목과 본문의 매핑이 어긋날 가능성.

### 3.3. 렌더링 및 이미지 누락 (ERR-01, ERR-04)
* **추정 원인:**
    * **Lazy Loading:** 크롤러가 JavaScript로 로드되는 이미지 태그를 해석하기 전에 긁어와서 URL이 누락됨.
    * **JSON 파싱 에러:** 본문 내 특수문자나 이모지가 JSON 형식을 깨뜨려 프론트엔드에서 인터랙션(펼치기) 이벤트가 바인딩되지 않음.

---

## 4. 디버깅 포인트 및 대응 전략 (Action Plan)

### Phase 1: 파이프라인 안정화
* **Rate Limiting 구현:** API 호출 사이에 짧은 지연 시간(Sleep)을 두어 RPM 제한 회피.
* **데이터 검증(Validation):** DB 저장 직전, 제목/본문/이미지/요약문 중 하나라도 `null`이면 저장하지 않거나 에러 로그 기록.

### Phase 2: 크롤링 정교화
* **Cleaning 로직 강화:** 정규표현식을 사용하여 본문 내 특수문자, HTML 태그, "Copyright", "댓글" 관련 키워드 제거.
* **Selector 최적화:** 주요 언론사별 맞춤형 CSS Selector 적용 또는 메타 태그(`og:image`, `og:description`) 우선 활용.

### Phase 3: 프론트엔드 예외 처리
* **Fallback 이미지:** 이미지 로드 실패 시 기본 썸네일 노출.
* **Click Event 디버깅:** 콘솔 로그를 통해 카드 뉴스 객체의 ID값이 인터랙션 함수에 정상 전달되는지 확인.

---

## 5. 최종 기대 결과 (Success Metrics)
* 모든 카드 뉴스에 유효한 3줄 요약과 이미지 존재 확인.
* API 호출 시 429(Too Many Requests) 에러 발생률 0%.
* 뉴스 본문 내 불필요한 댓글 포함 비중 0%.